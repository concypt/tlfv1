"use strict";(()=>{var b=window.$memberstackDom,g=window.location.href.split("/").pop(),H=g==null?void 0:g.split("?")[0];b.getCurrentMember().then(({data:t})=>{t||x()});var x=()=>{let t=!0,e=document.referrer.split("/").pop();(e==null?void 0:e.split("?")[0])==="fdiautvtn"&&(t=!1);let i=new URLSearchParams(window.location.search),n=Object.fromEntries(i.entries());if(n){let s=document.querySelector('[data-element="contact-agent-name"]');if(!s)return;s.textContent=n.name;let c=document.querySelector('[data-element="contact-agent-phone"]');if(!c)return;c.textContent=n.phone,c.closest("a").href="tel:"+n.phone;let o=document.querySelector('[data-element="contact-agent-email"]');if(!o)return;o.textContent=n.email,o.closest("a").href="mailto:"+n.email;let d=document.querySelector('[data-element="contact-agent-agency"]');if(!d)return;d.textContent=n.agency;let m=document.querySelector('[data-element="m-contact-agent-name"]');if(!m)return;m.textContent=n.name;let l=document.querySelector('[data-element="m-contact-agent-phone"]');if(!l)return;l.textContent=n.phone,l.closest("a").href="tel:"+n.phone;let u=document.querySelector('[data-element="m-contact-agent-email"]');if(!u)return;u.textContent=n.email,u.closest("a").href="mailto:"+n.email;let p=document.querySelector('[data-element="m-contact-agent-agency"]');if(!p)return;p.textContent=n.agency}t&&(window.location.href="/login")};$(()=>{var e,a,i;b.getCurrentMember().then(({data:n})=>{if(n){let s=new Date;s=String(s.getDate()).padStart(2,"0")+"-"+String(s.getMonth()+1).padStart(2,"0")+"-"+s.getFullYear();let c=n.customFields["first-name"]+" "+n.customFields["last-name"],o=n.customFields.mobile,d=n.auth.email,m=n.customFields["agency-name"],l="?name="+c+"&phone="+o+"&email="+d+"&agency="+m+"&listing="+H+"&created="+s,u="https://"+window.location.hostname+"/fdiautvtn"+encodeURI(l),p=document.querySelector("#input-url");p&&(p.value=u);let y=document.querySelector("#btn-copy-url");y==null||y.addEventListener("click",function(f){f.preventDefault(),v(u)});let r=document.querySelector('[data-element="btn-fake-share-url"]');r==null||r.addEventListener("click",function(f){f.preventDefault(),v(u)})}});let t=(e=document.querySelector('[data-element="btn-schedule-viewing"]'))==null?void 0:e.getAttribute("href");if(t==="https://www.thelistingsfactory.co.nz/schedule-viewing"){let n=(a=document.querySelector('[data-element="address"]'))==null?void 0:a.textContent,s=t+"?address="+n;(i=document.querySelector('[data-element="btn-schedule-viewing"]'))==null||i.setAttribute("href",s)}});function k(t){let e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(a){console.error("Fallback: Oops, unable to copy",a)}document.body.removeChild(e),w('[data-element="wait-notification"]','[data-element="copied-notification"]')}function v(t){if(!navigator.clipboard){k(t);return}navigator.clipboard.writeText(t).then(function(){w('[data-element="wait-notification"]','[data-element="copied-notification"]')},function(e){console.log(e)})}function w(t,e){let a=document.querySelector(t),i=document.querySelector(e);a&&(a.style.display="block"),setTimeout(()=>{a&&(a.style.display="none"),i&&(i.style.display="block"),setTimeout(()=>{i&&(i.style.display="none")},1e3)},600)}var A=document.querySelector("[at-pat]").getAttribute("at-pat");async function U(t,e){let a;t=T(t)||"",e?(e=T(e)||"",a="https://api.airtable.com/v0/appWNf6XfqAR6n0oT/"+encodeURIComponent(t)+"&view="+encodeURIComponent(e).replace(/%20/g,"+")):a="https://api.airtable.com/v0/appWNf6XfqAR6n0oT/"+encodeURIComponent(t);let i={Authorization:`Bearer ${A}`};return await(await fetch(a,{headers:i})).json()}var C;tableName?U(tableName,tableViewName).then(t=>P(t)):((C=document.querySelector('[data-element="sl-table-wrapper"]'))==null||C.remove(),document.querySelector('[data-element="sl-title"]').textContent="Stocklist not found");var P=t=>{var y;if(t.error){(y=document.querySelector('[data-element="sl-table-wrapper"]'))==null||y.remove(),document.querySelector('[data-element="sl-title"]').textContent="Stocklist not found";return}let e=t.records;e.forEach(r=>{/^\d+$/.test(r.fields["Unit/Lot"])&&(r.fields["Unit/Lot"]=parseInt(r.fields["Unit/Lot"])),r.fields.Price&&(r.fields.Price="$"+N(r.fields.Price))});let a=e[0].fields,i=Object.keys(a),s=["Unit/Lot","Price","Beds","Baths","Car Park","Internal"].filter(r=>i.indexOf(r)>-1),c=i.filter(r=>s.indexOf(r)===-1);c.push(c.splice(c.indexOf("Status"),1)[0]),c.forEach(r=>{r!=="Discount"&&s.push(r)});let o=document.querySelector('[data-element="table-row"]'),d=o==null?void 0:o.firstChild;o!=null&&o.innerHTML&&(o.innerHTML="");let m="grid-template-columns: ";s.forEach(r=>{let f=d==null?void 0:d.cloneNode(!0);f.textContent=r,f.setAttribute("data-sortelement",r),o==null||o.append(f),m=m+"1fr "}),document.querySelectorAll(".s-table-row-inner").forEach(r=>{r.setAttribute("style",m)});let l=document.querySelector('[data-element="stocklist-row"]');if(!l)return;let u=l==null?void 0:l.parentElement;if(!u)return;h(e,l,u,"Unit/Lot","asc",s),document.querySelectorAll(".s-table-head-item").forEach(r=>{r.addEventListener("click",f=>{var L,S,E;f.preventDefault(),r.classList.contains("selected")||((L=document.querySelector(".selected"))==null||L.classList.remove("asc"),(S=document.querySelector(".selected"))==null||S.classList.remove("desc"),(E=document.querySelector(".selected"))==null||E.classList.remove("selected")),r.classList.contains("desc")&&!r.classList.contains("first")?(h(e,l,u,r.dataset.sortelement,"asc",s),r.classList.add("selected","asc"),r.classList.remove("desc")):(h(e,l,u,r.dataset.sortelement,"desc",s),r.classList.contains("first")||(r.classList.add("selected","desc"),r.classList.remove("asc")))})})},h=(t,e,a,i,n,s)=>{a.innerHTML="";let c=!1,o=I(t,i,n);for(let d in o)if(o.hasOwnProperty(d)){let m=o[d].fields,l=R(e,m,s);if(!l)return;c&&l.classList.add("colored"),c=!c,a.append(l)}},R=(t,e,a)=>{let i=t.cloneNode(!0),n=i.querySelector(".s-table-cell-item"),s=n==null?void 0:n.parentElement;if(s&&n)return s.innerHTML="",i.innerHTML="",a.forEach(c=>{let o=n.cloneNode(!0);o.setAttribute("data-element",c),o.textContent=e[c],(c==="Internal"||c==="External"||c==="Land Size"||c==="Land"||c==="Lot Size")&&(o.innerHTML=Math.floor(e[c])+"m <sup>2</sup>"),c==="Status"&&(e[c]==="Sold"?o.classList.add("status-red"):e[c]==="Under Contract"?o.classList.add("status-orange"):e[c]==="Available"&&o.classList.add("status-green")),s.append(o)}),i.append(s),i},I=(t,e,a)=>{if(e==="Default")return t;let i=typeof t[0].fields[e];if(!i)return;let n=t.slice(0);if(i==="number")n.sort(function(s,c){let o;return a==="desc"?o=c.fields[e]-s.fields[e]:a==="asc"&&(o=s.fields[e]-c.fields[e]),o});else if(i==="string"||i==="Default"){let s=(c,o)=>{let d=c.fields[e].toLowerCase(),m=o.fields[e].toLowerCase(),l;return a==="desc"?l=m.localeCompare(d,"en",{numeric:!0}):a==="asc"&&(l=d.localeCompare(m,"en",{numeric:!0})),l};n.sort(s)}return n};function N(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function T(t){return new DOMParser().parseFromString(t,"text/html").documentElement.textContent}function D(){var a;let t=(a=document.querySelector('[data-element="address"]'))==null?void 0:a.textContent;if(!t)return;let e="/request-for-contract?address="+encodeURIComponent(t)+"&at="+encodeURIComponent(tableName)+"&atv="+encodeURIComponent(tableViewName);window.open(e,"_blank")}var q;(q=document.querySelector("#btn-request-a-contract"))==null||q.addEventListener("click",t=>{t.preventDefault(),D()});var M;(M=document.querySelector("#btn-request-a-contract-m"))==null||M.addEventListener("click",t=>{t.preventDefault(),D()});})();
