"use strict";(()=>{var b=window.$memberstackDom,L=window.location.href.split("/").pop(),H=L==null?void 0:L.split("?")[0];b.getCurrentMember().then(({data:t})=>{t||D()});var D=()=>{let t=!0,e=document.referrer.split("/").pop(),c=e==null?void 0:e.split("?")[0],a=document.querySelectorAll('[data-element="refferer-item"]');if(!a)return;a.forEach(r=>{var d,l;let o=(d=r.querySelector('[data-element="refferer-name"]'))==null?void 0:d.textContent,m=(l=r.querySelector('[data-element="refferer-listing"]'))==null?void 0:l.textContent;o===c&&m===H&&(t=!1)});let i=new URLSearchParams(window.location.search),n=Object.fromEntries(i.entries());if(n){let r=document.querySelector('[data-element="contact-agent-name"]');if(!r)return;r.textContent=n.name;let o=document.querySelector('[data-element="contact-agent-phone"]');if(!o)return;o.textContent=n.phone,o.closest("a").href="tel:"+n.phone;let m=document.querySelector('[data-element="contact-agent-email"]');if(!m)return;m.textContent=n.email,m.closest("a").href="mailto:"+n.email;let d=document.querySelector('[data-element="contact-agent-agency"]');if(!d)return;d.textContent=n.agency;let l=document.querySelector('[data-element="m-contact-agent-name"]');if(!l)return;l.textContent=n.name;let u=document.querySelector('[data-element="m-contact-agent-phone"]');if(!u)return;u.textContent=n.phone,u.closest("a").href="tel:"+n.phone;let y=document.querySelector('[data-element="m-contact-agent-email"]');if(!y)return;y.textContent=n.email,y.closest("a").href="mailto:"+n.email;let p=document.querySelector('[data-element="m-contact-agent-agency"]');if(!p)return;p.textContent=n.agency}t&&(window.location.href="/login")};$(()=>{var e,c,a;b.getCurrentMember().then(({data:i})=>{if(i){let n=i.customFields["first-name"]+" "+i.customFields["last-name"],r=i.customFields.mobile,o=i.auth.email,m=i.customFields["agency-name"],d="?name="+n+"&phone="+r+"&email="+o+"&agency="+m,l=A(21),u="https://"+window.location.hostname+"/fdiautvtnzxynmp/"+l+"/"+d,y=document.querySelector("#input-url"),p=document.querySelector("#input-share-slug"),s=document.querySelector("#input-listing"),f=document.querySelector('[data-element="fake-text"]');y&&(y.value=u),p&&(p.value=l),s&&L&&(s.value=L),f&&(f.innerHTML=u);let g=document.querySelector("#btn-copy-url");g==null||g.addEventListener("click",function(S){E(u)});let h=document.querySelector('[data-element="btn-fake-share-url"]');h==null||h.addEventListener("click",function(S){E(u)})}});let t=(e=document.querySelector('[data-element="btn-schedule-viewing"]'))==null?void 0:e.getAttribute("href");if(t==="https://www.thelistingsfactory.co.nz/schedule-viewing"){let i=(c=document.querySelector('[data-element="address"]'))==null?void 0:c.textContent,n=t+"?address="+i;(a=document.querySelector('[data-element="btn-schedule-viewing"]'))==null||a.setAttribute("href",n)}});function k(t){let e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(c){console.error("Fallback: Oops, unable to copy",c)}document.body.removeChild(e),x('[data-element="wait-notification"]','[data-element="copied-notification"]')}function E(t){if(!navigator.clipboard){k(t);return}navigator.clipboard.writeText(t).then(function(){x('[data-element="wait-notification"]','[data-element="copied-notification"]')},function(e){console.log(e)})}function x(t,e){let c=document.querySelector(t),a=document.querySelector(e);c&&(c.style.display="block"),setTimeout(()=>{c&&(c.style.display="none"),a&&(a.style.display="block"),setTimeout(()=>{a&&(a.style.display="none")},1e3)},3e3)}function A(t){let e="",c="abcdefghijklmnopqrstuvwxyz0123456789",a=c.length;for(let i=0;i<t;i++)e+=c.charAt(Math.floor(Math.random()*a));return e}async function U(t,e){let c;return t=C(t)||"",e?(e=C(e)||"",c="https://api.airtable.com/v0/appWNf6XfqAR6n0oT/"+encodeURIComponent(t)+"?api_key=keyUxdcC40qxNrt1Y&&view="+encodeURIComponent(e).replace(/%20/g,"+")):c="https://api.airtable.com/v0/appWNf6XfqAR6n0oT/"+encodeURIComponent(t)+"?api_key=keyUxdcC40qxNrt1Y&",await(await fetch(c)).json()}var T;tableName?U(tableName,tableViewName).then(t=>P(t)):((T=document.querySelector('[data-element="sl-table-wrapper"]'))==null||T.remove(),document.querySelector('[data-element="sl-title"]').textContent="Stocklist not found");var P=t=>{var p;if(t.error){(p=document.querySelector('[data-element="sl-table-wrapper"]'))==null||p.remove(),document.querySelector('[data-element="sl-title"]').textContent="Stocklist not found";return}let e=t.records;e.forEach(s=>{/^\d+$/.test(s.fields["Unit/Lot"])&&(s.fields["Unit/Lot"]=parseInt(s.fields["Unit/Lot"])),s.fields.Price&&(s.fields.Price="$"+R(s.fields.Price))});let c=e[0].fields,a=Object.keys(c),n=["Unit/Lot","Price","Beds","Baths","Car Park","Internal"].filter(s=>a.indexOf(s)>-1),r=a.filter(s=>n.indexOf(s)===-1);r.push(r.splice(r.indexOf("Status"),1)[0]),r.forEach(s=>{s!=="Discount"&&n.push(s)});let o=document.querySelector('[data-element="table-row"]'),m=o==null?void 0:o.firstChild;o!=null&&o.innerHTML&&(o.innerHTML="");let d="grid-template-columns: ";n.forEach(s=>{let f=m==null?void 0:m.cloneNode(!0);f.textContent=s,f.setAttribute("data-sortelement",s),o==null||o.append(f),d=d+"1fr "}),document.querySelectorAll(".s-table-row-inner").forEach(s=>{s.setAttribute("style",d)});let l=document.querySelector('[data-element="stocklist-row"]');if(!l)return;let u=l==null?void 0:l.parentElement;if(!u)return;q(e,l,u,"Unit/Lot","asc",n),document.querySelectorAll(".s-table-head-item").forEach(s=>{s.addEventListener("click",f=>{var g,h,S;f.preventDefault(),s.classList.contains("selected")||((g=document.querySelector(".selected"))==null||g.classList.remove("asc"),(h=document.querySelector(".selected"))==null||h.classList.remove("desc"),(S=document.querySelector(".selected"))==null||S.classList.remove("selected")),s.classList.contains("desc")&&!s.classList.contains("first")?(q(e,l,u,s.dataset.sortelement,"asc",n),s.classList.add("selected","asc"),s.classList.remove("desc")):(q(e,l,u,s.dataset.sortelement,"desc",n),s.classList.contains("first")||(s.classList.add("selected","desc"),s.classList.remove("asc")))})})},q=(t,e,c,a,i,n)=>{c.innerHTML="";let r=!1,o=N(t,a,i);for(let m in o)if(o.hasOwnProperty(m)){let d=o[m].fields,l=I(e,d,n);if(!l)return;r&&l.classList.add("colored"),r=!r,c.append(l)}},I=(t,e,c)=>{let a=t.cloneNode(!0),i=a.querySelector(".s-table-cell-item"),n=i==null?void 0:i.parentElement;if(n&&i)return n.innerHTML="",a.innerHTML="",c.forEach(r=>{let o=i.cloneNode(!0);o.setAttribute("data-element",r),o.textContent=e[r],(r==="Internal"||r==="External"||r==="Land Size"||r==="Land"||r==="Lot Size")&&(o.innerHTML=Math.floor(e[r])+"m <sup>2</sup>"),r==="Status"&&(e[r]==="Sold"?o.classList.add("status-red"):e[r]==="Under Contract"?o.classList.add("status-orange"):e[r]==="Available"&&o.classList.add("status-green")),n.append(o)}),a.append(n),a},N=(t,e,c)=>{if(e==="Default")return t;let a=typeof t[0].fields[e];if(!a)return;let i=t.slice(0);if(a==="number")i.sort(function(n,r){let o;return c==="desc"?o=r.fields[e]-n.fields[e]:c==="asc"&&(o=n.fields[e]-r.fields[e]),o});else if(a==="string"||a==="Default"){let n=(r,o)=>{let m=r.fields[e].toLowerCase(),d=o.fields[e].toLowerCase(),l;return c==="desc"?l=d.localeCompare(m,"en",{numeric:!0}):c==="asc"&&(l=m.localeCompare(d,"en",{numeric:!0})),l};i.sort(n)}return i};function R(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function C(t){return new DOMParser().parseFromString(t,"text/html").documentElement.textContent}function w(){var c;let t=(c=document.querySelector('[data-element="address"]'))==null?void 0:c.textContent;if(!t)return;let e="/request-for-contract?address="+encodeURIComponent(t)+"&at="+encodeURIComponent(tableName)+"&atv="+encodeURIComponent(tableViewName);window.open(e,"_blank")}var v;(v=document.querySelector("#btn-request-a-contract"))==null||v.addEventListener("click",t=>{t.preventDefault(),w()});var M;(M=document.querySelector("#btn-request-a-contract-m"))==null||M.addEventListener("click",t=>{t.preventDefault(),w()});})();
