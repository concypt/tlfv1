"use strict";(()=>{var b=window.$memberstackDom,g=window.location.href.split("/").pop(),D=g==null?void 0:g.split("?")[0];b.getCurrentMember().then(({data:t})=>{t||H()});var H=()=>{let t=!0,e=document.referrer.split("/").pop();(e==null?void 0:e.split("?")[0])==="fdiautvtn"&&(t=!1);let i=new URLSearchParams(window.location.search),n=Object.fromEntries(i.entries());if(n){let a=document.querySelector('[data-element="contact-agent-name"]');if(!a)return;a.textContent=n.name;let r=document.querySelector('[data-element="contact-agent-phone"]');if(!r)return;r.textContent=n.phone,r.closest("a").href="tel:"+n.phone;let o=document.querySelector('[data-element="contact-agent-email"]');if(!o)return;o.textContent=n.email,o.closest("a").href="mailto:"+n.email;let d=document.querySelector('[data-element="contact-agent-agency"]');if(!d)return;d.textContent=n.agency;let m=document.querySelector('[data-element="m-contact-agent-name"]');if(!m)return;m.textContent=n.name;let l=document.querySelector('[data-element="m-contact-agent-phone"]');if(!l)return;l.textContent=n.phone,l.closest("a").href="tel:"+n.phone;let u=document.querySelector('[data-element="m-contact-agent-email"]');if(!u)return;u.textContent=n.email,u.closest("a").href="mailto:"+n.email;let p=document.querySelector('[data-element="m-contact-agent-agency"]');if(!p)return;p.textContent=n.agency}t&&(window.location.href="/login")};$(()=>{var e,s,i;b.getCurrentMember().then(({data:n})=>{if(n){let a=new Date;a=String(a.getDate()).padStart(2,"0")+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+a.getFullYear();let r=n.customFields["first-name"]+" "+n.customFields["last-name"],o=n.customFields.mobile,d=n.auth.email,m=n.customFields["agency-name"],l="?name="+r+"&phone="+o+"&email="+d+"&agency="+m+"&listing="+D+"&created="+a,u="https://"+window.location.hostname+"/fdiautvtn"+encodeURI(l),p=document.querySelector("#input-url");p&&(p.value=u);let y=document.querySelector("#btn-copy-url");y==null||y.addEventListener("click",function(f){f.preventDefault(),E(u)});let c=document.querySelector('[data-element="btn-fake-share-url"]');c==null||c.addEventListener("click",function(f){f.preventDefault(),E(u)})}});let t=(e=document.querySelector('[data-element="btn-schedule-viewing"]'))==null?void 0:e.getAttribute("href");if(t==="https://www.thelistingsfactory.co.nz/schedule-viewing"){let n=(s=document.querySelector('[data-element="address"]'))==null?void 0:s.textContent,a=t+"?address="+n;(i=document.querySelector('[data-element="btn-schedule-viewing"]'))==null||i.setAttribute("href",a)}});function k(t){let e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(s){console.error("Fallback: Oops, unable to copy",s)}document.body.removeChild(e),w('[data-element="wait-notification"]','[data-element="copied-notification"]')}function E(t){if(!navigator.clipboard){k(t);return}navigator.clipboard.writeText(t).then(function(){w('[data-element="wait-notification"]','[data-element="copied-notification"]')},function(e){console.log(e)})}function w(t,e){let s=document.querySelector(t),i=document.querySelector(e);s&&(s.style.display="block"),setTimeout(()=>{s&&(s.style.display="none"),i&&(i.style.display="block"),setTimeout(()=>{i&&(i.style.display="none")},1e3)},600)}async function A(t,e){let s;return t=v(t)||"",e?(e=v(e)||"",s="https://api.airtable.com/v0/appWNf6XfqAR6n0oT/"+encodeURIComponent(t)+"?api_key=keyUxdcC40qxNrt1Y&&view="+encodeURIComponent(e).replace(/%20/g,"+")):s="https://api.airtable.com/v0/appWNf6XfqAR6n0oT/"+encodeURIComponent(t)+"?api_key=keyUxdcC40qxNrt1Y&",await(await fetch(s)).json()}var T;tableName?A(tableName,tableViewName).then(t=>U(t)):((T=document.querySelector('[data-element="sl-table-wrapper"]'))==null||T.remove(),document.querySelector('[data-element="sl-title"]').textContent="Stocklist not found");var U=t=>{var y;if(t.error){(y=document.querySelector('[data-element="sl-table-wrapper"]'))==null||y.remove(),document.querySelector('[data-element="sl-title"]').textContent="Stocklist not found";return}let e=t.records;e.forEach(c=>{/^\d+$/.test(c.fields["Unit/Lot"])&&(c.fields["Unit/Lot"]=parseInt(c.fields["Unit/Lot"])),c.fields.Price&&(c.fields.Price="$"+R(c.fields.Price))});let s=e[0].fields,i=Object.keys(s),a=["Unit/Lot","Price","Beds","Baths","Car Park","Internal"].filter(c=>i.indexOf(c)>-1),r=i.filter(c=>a.indexOf(c)===-1);r.push(r.splice(r.indexOf("Status"),1)[0]),r.forEach(c=>{c!=="Discount"&&a.push(c)});let o=document.querySelector('[data-element="table-row"]'),d=o==null?void 0:o.firstChild;o!=null&&o.innerHTML&&(o.innerHTML="");let m="grid-template-columns: ";a.forEach(c=>{let f=d==null?void 0:d.cloneNode(!0);f.textContent=c,f.setAttribute("data-sortelement",c),o==null||o.append(f),m=m+"1fr "}),document.querySelectorAll(".s-table-row-inner").forEach(c=>{c.setAttribute("style",m)});let l=document.querySelector('[data-element="stocklist-row"]');if(!l)return;let u=l==null?void 0:l.parentElement;if(!u)return;h(e,l,u,"Unit/Lot","asc",a),document.querySelectorAll(".s-table-head-item").forEach(c=>{c.addEventListener("click",f=>{var L,S,C;f.preventDefault(),c.classList.contains("selected")||((L=document.querySelector(".selected"))==null||L.classList.remove("asc"),(S=document.querySelector(".selected"))==null||S.classList.remove("desc"),(C=document.querySelector(".selected"))==null||C.classList.remove("selected")),c.classList.contains("desc")&&!c.classList.contains("first")?(h(e,l,u,c.dataset.sortelement,"asc",a),c.classList.add("selected","asc"),c.classList.remove("desc")):(h(e,l,u,c.dataset.sortelement,"desc",a),c.classList.contains("first")||(c.classList.add("selected","desc"),c.classList.remove("asc")))})})},h=(t,e,s,i,n,a)=>{s.innerHTML="";let r=!1,o=N(t,i,n);for(let d in o)if(o.hasOwnProperty(d)){let m=o[d].fields,l=P(e,m,a);if(!l)return;r&&l.classList.add("colored"),r=!r,s.append(l)}},P=(t,e,s)=>{let i=t.cloneNode(!0),n=i.querySelector(".s-table-cell-item"),a=n==null?void 0:n.parentElement;if(a&&n)return a.innerHTML="",i.innerHTML="",s.forEach(r=>{let o=n.cloneNode(!0);o.setAttribute("data-element",r),o.textContent=e[r],(r==="Internal"||r==="External"||r==="Land Size"||r==="Land"||r==="Lot Size")&&(o.innerHTML=Math.floor(e[r])+"m <sup>2</sup>"),r==="Status"&&(e[r]==="Sold"?o.classList.add("status-red"):e[r]==="Under Contract"?o.classList.add("status-orange"):e[r]==="Available"&&o.classList.add("status-green")),a.append(o)}),i.append(a),i},N=(t,e,s)=>{if(e==="Default")return t;let i=typeof t[0].fields[e];if(!i)return;let n=t.slice(0);if(i==="number")n.sort(function(a,r){let o;return s==="desc"?o=r.fields[e]-a.fields[e]:s==="asc"&&(o=a.fields[e]-r.fields[e]),o});else if(i==="string"||i==="Default"){let a=(r,o)=>{let d=r.fields[e].toLowerCase(),m=o.fields[e].toLowerCase(),l;return s==="desc"?l=m.localeCompare(d,"en",{numeric:!0}):s==="asc"&&(l=d.localeCompare(m,"en",{numeric:!0})),l};n.sort(a)}return n};function R(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function v(t){return new DOMParser().parseFromString(t,"text/html").documentElement.textContent}function x(){var s;let t=(s=document.querySelector('[data-element="address"]'))==null?void 0:s.textContent;if(!t)return;let e="/request-for-contract?address="+encodeURIComponent(t)+"&at="+encodeURIComponent(tableName)+"&atv="+encodeURIComponent(tableViewName);window.open(e,"_blank")}var q;(q=document.querySelector("#btn-request-a-contract"))==null||q.addEventListener("click",t=>{t.preventDefault(),x()});var M;(M=document.querySelector("#btn-request-a-contract-m"))==null||M.addEventListener("click",t=>{t.preventDefault(),x()});})();
